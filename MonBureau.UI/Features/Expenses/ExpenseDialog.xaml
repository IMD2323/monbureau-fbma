<Window
    x:Class="MonBureau.UI.Views.Dialogs.ExpenseDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Depense"
    Width="700"
    Height="750"
    Background="{StaticResource BackgroundBrush}"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterOwner">

    <Border Padding="32">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Header  -->
            <StackPanel Grid.Row="0" Margin="0,0,0,24">
                <TextBlock
                    FontSize="24"
                    FontWeight="Bold"
                    Foreground="{StaticResource TextPrimaryBrush}">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="{}{0} Dépense">
                            <Binding Path="IsEditMode" />
                            <Binding
                                Converter="{StaticResource BoolToStringConverter}"
                                ConverterParameter="Modifier:Nouvelle"
                                Path="IsEditMode" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
                <TextBlock
                    Margin="0,4,0,0"
                    FontSize="14"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Text="Enregistrer une dépense liée à un dossier" />
            </StackPanel>

            <!--  Form  -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!--  Description  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            Text="Description *" />
                        <TextBox
                            Style="{StaticResource ModernTextBox}"
                            Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                            TextWrapping="Wrap" />
                    </StackPanel>

                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!--  Amount  -->
                        <StackPanel Grid.Column="0">
                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="13"
                                FontWeight="Medium"
                                Text="Montant (DA) *" />
                            <TextBox Style="{StaticResource ModernTextBox}" Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <!--  Date  -->
                        <StackPanel Grid.Column="2">
                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="13"
                                FontWeight="Medium"
                                Text="Date *" />
                            <DatePicker SelectedDate="{Binding Date}" Style="{StaticResource ModernDatePicker}" />
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!--  Category  -->
                        <StackPanel Grid.Column="0">
                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="13"
                                FontWeight="Medium"
                                Text="Catégorie *" />
                            <ComboBox
                                DisplayMemberPath="."
                                ItemsSource="{Binding ExpenseCategories}"
                                SelectedItem="{Binding SelectedCategory}"
                                Style="{StaticResource ModernComboBox}" />
                        </StackPanel>

                        <!--  Payment Method  -->
                        <StackPanel Grid.Column="2">
                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="13"
                                FontWeight="Medium"
                                Text="Mode de Paiement" />
                            <ComboBox
                                IsEditable="True"
                                Style="{StaticResource ModernComboBox}"
                                Text="{Binding PaymentMethod, UpdateSourceTrigger=PropertyChanged}">
                                <ComboBoxItem Content="Espèces" />
                                <ComboBoxItem Content="Chèque" />
                                <ComboBoxItem Content="Virement" />
                                <ComboBoxItem Content="Carte Bancaire" />
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <!--  Recipient  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Text="Bénéficiaire" />
                        <TextBox Style="{StaticResource ModernTextBox}" Text="{Binding Recipient, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>

                    <!--  Case Selection  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Text="Dossier *" />
                        <ComboBox
                            DisplayMemberPath="Number"
                            ItemsSource="{Binding Cases}"
                            SelectedItem="{Binding SelectedCase}"
                            Style="{StaticResource ModernComboBox}" />
                    </StackPanel>

                    <!--  Client Selection (Optional)  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Text="Ajouté par (Client)" />
                        <ComboBox
                            DisplayMemberPath="FullName"
                            ItemsSource="{Binding Clients}"
                            SelectedItem="{Binding AddedByClient}"
                            Style="{StaticResource ModernComboBox}" />
                    </StackPanel>

                    <!--  Receipt/Invoice  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Text="Reçu/Facture" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox
                                Grid.Column="0"
                                IsReadOnly="True"
                                Style="{StaticResource ModernTextBox}"
                                Text="{Binding ReceiptPath}" />
                            <Button
                                Grid.Column="1"
                                Margin="8,0,0,0"
                                Padding="16,10"
                                Command="{Binding BrowseReceiptCommand}"
                                Content="Parcourir..."
                                Style="{StaticResource OutlineButton}" />
                        </Grid>
                    </StackPanel>

                    <!--  Notes  -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock
                            Margin="0,0,0,8"
                            FontSize="13"
                            FontWeight="Medium"
                            Text="Notes" />
                        <TextBox
                            MinHeight="80"
                            AcceptsReturn="True"
                            Style="{StaticResource ModernTextBox}"
                            Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                            TextWrapping="Wrap" />
                    </StackPanel>

                    <!--  Is Paid  -->
                    <CheckBox
                        Content="Dépense payée"
                        IsChecked="{Binding IsPaid}"
                        Style="{StaticResource ModernCheckBox}" />

                    <!--  Validation Error  -->
                    <Border
                        Margin="0,20,0,0"
                        Padding="12"
                        Background="{StaticResource ErrorSubtleBrush}"
                        BorderBrush="{StaticResource ErrorBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Visibility="{Binding ValidationError, Converter={StaticResource BoolToVis}}">
                        <TextBlock
                            FontSize="13"
                            Foreground="{StaticResource ErrorBrush}"
                            Text="{Binding ValidationError}"
                            TextWrapping="Wrap" />
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!--  Actions  -->
            <Grid Grid.Row="2" Margin="0,24,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button
                    Grid.Column="1"
                    Margin="0,0,12,0"
                    Padding="24,12"
                    Command="{Binding CancelCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                    Content="Annuler"
                    Style="{StaticResource OutlineButton}" />

                <Button
                    Grid.Column="2"
                    Padding="24,12"
                    Command="{Binding SaveCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                    Content="Enregistrer"
                    Style="{StaticResource PrimaryButton}" />
            </Grid>
        </Grid>
    </Border>
</Window>