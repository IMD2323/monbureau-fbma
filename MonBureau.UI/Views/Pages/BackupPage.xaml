<!--
    ============================================================
    BackupPage.xaml - Using static localization
    Remove loc: prefix and use direct text for now
    ============================================================
-->
<Page
    x:Class="MonBureau.UI.Views.Pages.BackupPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="{StaticResource BackgroundBrush}">

    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Loading Overlay  -->
        <Border
            Grid.Row="0"
            Grid.RowSpan="2"
            Panel.ZIndex="999"
            Background="#80000000"
            CornerRadius="12"
            Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVis}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar
                    Width="200"
                    Height="4"
                    Foreground="{StaticResource PrimaryBrush}"
                    IsIndeterminate="True" />
                <TextBlock
                    Margin="0,16,0,0"
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="White"
                    Text="{Binding StatusMessage}" />
            </StackPanel>
        </Border>

        <!--  Header  -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <StackPanel>
                <TextBlock
                    FontSize="28"
                    FontWeight="Bold"
                    Foreground="{StaticResource TextPrimaryBrush}"
                    Text="Backup &amp; Restore" />
                <TextBlock
                    FontSize="14"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Text="Manage your data backups" />
            </StackPanel>
        </Grid>

        <!--  Content  -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!--  Quick Actions Card  -->
                <Border Margin="0,0,0,24" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,16"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            Text="Quick Actions" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!--  Create Backup  -->
                            <Button
                                Grid.Column="0"
                                Height="100"
                                Margin="0,0,8,0"
                                Command="{Binding CreateBackupCommand}"
                                Style="{StaticResource OutlineButton}">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,8"
                                        HorizontalAlignment="Center"
                                        FontFamily="Segoe MDL2 Assets"
                                        FontSize="32"
                                        Foreground="{StaticResource PrimaryBrush}"
                                        Text="&#xE74E;" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="13"
                                        FontWeight="Medium"
                                        Text="Create Backup" />
                                </StackPanel>
                            </Button>

                            <!--  Restore Backup  -->
                            <Button
                                Grid.Column="1"
                                Height="100"
                                Margin="4,0"
                                Command="{Binding SelectRestoreFileCommand}"
                                Style="{StaticResource OutlineButton}">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,8"
                                        HorizontalAlignment="Center"
                                        FontFamily="Segoe MDL2 Assets"
                                        FontSize="32"
                                        Foreground="{StaticResource SuccessBrush}"
                                        Text="&#xE777;" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="13"
                                        FontWeight="Medium"
                                        Text="Restore" />
                                </StackPanel>
                            </Button>

                            <!--  Open Folder  -->
                            <Button
                                Grid.Column="2"
                                Height="100"
                                Margin="8,0,0,0"
                                Command="{Binding OpenBackupFolderCommand}"
                                Style="{StaticResource OutlineButton}">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,8"
                                        HorizontalAlignment="Center"
                                        FontFamily="Segoe MDL2 Assets"
                                        FontSize="32"
                                        Foreground="{StaticResource AccentBrush}"
                                        Text="&#xE8DA;" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="13"
                                        FontWeight="Medium"
                                        Text="Open Folder" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>

                <!--  Auto Backup Settings  -->
                <Border Margin="0,0,0,24" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,16"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            Text="Automatic Backup" />

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!--  Enabled Toggle  -->
                            <TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                Text="Enable Auto-Backup" />
                            <CheckBox
                                Grid.Row="0"
                                Grid.Column="1"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                IsChecked="{Binding AutoBackupEnabled}" />

                            <!--  Interval  -->
                            <TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                Text="Frequency" />
                            <ComboBox
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="0,0,0,16"
                                Padding="12,10"
                                SelectedIndex="{Binding SelectedInterval}">
                                <ComboBoxItem Content="Daily" />
                                <ComboBoxItem Content="Every 3 Days" />
                                <ComboBoxItem Content="Weekly" />
                            </ComboBox>

                            <!--  Max Backups  -->
                            <TextBlock
                                Grid.Row="2"
                                Grid.Column="0"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                Text="Max Backups" />
                            <TextBox
                                Grid.Row="2"
                                Grid.Column="1"
                                Margin="0,0,0,16"
                                Padding="12,10"
                                Style="{StaticResource ModernTextBox}"
                                Text="{Binding MaxBackupCount}" />

                            <!--  Last Backup  -->
                            <TextBlock
                                Grid.Row="3"
                                Grid.Column="0"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                Text="Last Backup" />
                            <TextBlock
                                Grid.Row="3"
                                Grid.Column="1"
                                Margin="0,0,0,16"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource TextSecondaryBrush}"
                                Text="{Binding LastBackupDate, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />
                        </Grid>

                        <Button
                            Padding="20,12"
                            HorizontalAlignment="Right"
                            Command="{Binding SaveAutoBackupSettingsCommand}"
                            Content="Save Settings"
                            Style="{StaticResource ModernButton}" />
                    </StackPanel>
                </Border>

                <!--  Backup History  -->
                <Border Style="{StaticResource Card}">
                    <StackPanel>
                        <Grid Margin="0,0,0,16">
                            <TextBlock
                                FontSize="18"
                                FontWeight="SemiBold"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                Text="Backup History" />

                            <Button
                                Padding="12,8"
                                HorizontalAlignment="Right"
                                Command="{Binding RefreshHistoryCommand}"
                                Style="{StaticResource IconButton}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,8,0"
                                        FontFamily="Segoe MDL2 Assets"
                                        Foreground="{StaticResource PrimaryBrush}"
                                        Text="&#xE72C;" />
                                    <TextBlock Foreground="{StaticResource PrimaryBrush}" Text="Refresh" />
                                </StackPanel>
                            </Button>
                        </Grid>

                        <!--  Backup List  -->
                        <ListView
                            MaxHeight="400"
                            BorderThickness="0"
                            ItemsSource="{Binding BackupHistory}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Width="300" Header="File Name">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    FontWeight="Medium"
                                                    Foreground="{StaticResource TextPrimaryBrush}"
                                                    Text="{Binding FileName}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Width="150" Header="Date">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Text="{Binding CreatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Width="100" Header="Size">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Text="{Binding FormattedSize}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Width="200" Header="Content">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                                                        <Run Text="{Binding ClientCount, Mode=OneWay}" />
                                                        <Run Text="clients," />
                                                        <Run Text="{Binding CaseCount, Mode=OneWay}" />
                                                        <Run Text="cases" />
                                                    </TextBlock>
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Width="150" Header="Actions">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button
                                                        Margin="4,0"
                                                        Padding="8"
                                                        Command="{Binding DataContext.RestoreBackupCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                        CommandParameter="{Binding FilePath}"
                                                        Style="{StaticResource IconButton}"
                                                        ToolTip="Restore">
                                                        <TextBlock
                                                            FontFamily="Segoe MDL2 Assets"
                                                            FontSize="14"
                                                            Foreground="{StaticResource SuccessBrush}"
                                                            Text="&#xE777;" />
                                                    </Button>

                                                    <Button
                                                        Margin="4,0"
                                                        Padding="8"
                                                        Command="{Binding DataContext.DeleteBackupCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                        CommandParameter="{Binding FilePath}"
                                                        Style="{StaticResource IconButton}"
                                                        ToolTip="Delete">
                                                        <TextBlock
                                                            FontFamily="Segoe MDL2 Assets"
                                                            FontSize="14"
                                                            Foreground="{StaticResource ErrorBrush}"
                                                            Text="&#xE74D;" />
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>

                        <!--  Empty State  -->
                        <Border
                            Padding="40"
                            HorizontalAlignment="Center"
                            Visibility="{Binding BackupHistory.Count, Converter={StaticResource InverseBoolToVis}}">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock
                                    Margin="0,0,0,12"
                                    HorizontalAlignment="Center"
                                    FontSize="32"
                                    Text="📦" />
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Foreground="{StaticResource TextPrimaryBrush}"
                                    Text="No Backups" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    HorizontalAlignment="Center"
                                    FontSize="13"
                                    Foreground="{StaticResource TextSecondaryBrush}"
                                    Text="Create your first backup" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>